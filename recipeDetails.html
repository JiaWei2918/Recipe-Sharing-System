<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Details</title>
    <link rel="stylesheet" href="https://fonts.bunny.net/css?family=lora:400,400i,700,700i|playfair-display:400,700|poppins:400|roboto-condensed:400,700">
    <link rel="stylesheet" href="public/recipeDetails.css">
    <link rel="stylesheet" href="public/sidebar.css">
</head>
<body>
    <div id="sidebar-placeholder"></div>

    <div class="recipe-container">
        <div class="recipe-image" id="recipeImage">
        </div>

        <div class="recipe-content">
            <h1 id="recipeTitle">Recipe Title</h1>
            <p class="description" id="recipeDescription"> 
            </p>

            <div class="prep-time">
                <h2>Preparation Time</h2>
                <ul>
                    <li><strong>Total:</strong> <span id="totalTime">--</span> minutes</li>
                    <li><strong>Preparation:</strong> <span id="prepTime">--</span> minutes</li>
                    <li><strong>Cooking:</strong> <span id="cookTime">--</span> minutes</li>
                </ul>
            </div>

            <div class="ingredients">
                <h2>Ingredients</h2>
                <ul id="ingredientsList">
                </ul>
            </div>

            <div class="steps">
                <h2>Steps</h2>
                <ol id="stepsList">
                </ol>
            </div>
        </div>
    </div>

    <script type="module">
        import { db, doc, getDoc } from '/public/firebaseInit.js';

        const urlParams = new URLSearchParams(window.location.search);
        const recipeId = urlParams.get('id');

        async function fetchRecipeDetails(recipeId) {
            try {
                if (!recipeId) {
                    console.error("No recipe ID found in URL.");
                    return;
                }

                const docRef = doc(db, "recipes", recipeId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const recipe = docSnap.data();

                    document.getElementById("recipeTitle").innerText = recipe.title;
                    document.getElementById("recipeImage").innerHTML = `<img src="${recipe.image}" alt="${recipe.title}">`;
                    document.getElementById("recipeDescription").innerText = `From: ${recipe.source} | Category: ${recipe.category}`;
                    document.getElementById("totalTime").innerText = recipe.prepTotal || "--";
                    document.getElementById("prepTime").innerText = recipe.prepTime || "--";
                    document.getElementById("cookTime").innerText = recipe.cookTime || "--";

                    const ingredientsList = document.getElementById("ingredientsList");
                    recipe.ingredients.forEach(ingredient => {
                        const li = document.createElement("li");
                        li.innerText = ingredient;
                        ingredientsList.appendChild(li);
                    });

                    const stepsList = document.getElementById("stepsList");
                    recipe.steps.split(".").forEach(step => {
                        if (step.trim() !== "") {
                            const li = document.createElement("li");
                            li.innerText = step.trim();
                            stepsList.appendChild(li);
                        }
                    });
                } else {
                    console.error("No recipe found with this ID");
                }
            } catch (error) {
                console.error("Error fetching recipe details:", error);
            }
        }

        if (recipeId) {
            fetchRecipeDetails(recipeId);
        } else {
            console.error("No recipe ID provided in URL");
        }
    </script>

    <script type="module" src="public/sidebar.js"></script>
</body>
</html>
